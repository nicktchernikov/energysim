
{{!-- incude Plotly via CDN  --}}
<script src='https://cdn.plot.ly/plotly-latest.min.js'></script>

<style type="text/css">

    .plots {
        width: 1000px;
        display: inline-block;
    }
</style>

<script type="text/javascript">
    $(document).ready( function() {
        let house = {{{json dataset}}};
        let filenames = {{{json filenames}}};

        let settings = house[0];
        let filename = settings.filename;

        let rooms = house[1];

        // I can add layout info here too, which seems prettier to do
        if(settings) {
            $("#settings").append(
                "<b> Output file info:  </b> <br /> Simulation timestep length: " + settings.increment + " seconds <br /> Filename: "+filename+"<br /> Initial agent watchfulness: "+settings.watchfulness+"<br />"
            );
        }

        for(i = 0; i < filenames.length; i++) {
            $("#outputs").append("<option value='"+filenames[i]+"'>" + filenames[i] + "</option>");
        }

        {{!-- $("#plotsContainer").append(
            "<h2> total for the entire house </h2>"
        ); --}}

        if(rooms) {
            for(i = 0; i < rooms.length; i++) {  
                $("#plotsContainer").append(
                    "<h3>" + rooms[i].room_id + "</h3>"
                );  
                let appliances = rooms[i].appliances;
                for(j = 0; j < appliances.length; j++) {
                    $("#plotsContainer").append(
                        "<p> " + rooms[i].room_id + " :: " + appliances[j].appliance_id + " </p><div class='plots' id='plot_"+i+"_"+j+"'></div>"
                    );           
                }
                    
                $("#plotsContainer").append(
                    "<p><b> total for " + rooms[i].room_id + "</b></p> <div class='plots' id='plot_"+i+"_total'></div>"
                );
            }

            for(i = 0; i < rooms.length; i++) {    
                let appliances = rooms[i].appliances;
                let total_data = rooms[i].totalData;
                let total_layout = total_data.layout;
                for(j = 0; j < appliances.length; j++) {
                    let appliance_data = appliances[j].data;
                    //console.log(appliances[j].data.y);
                    let appliance_layout = appliances[j].layout;
                    let plot_id = "plot_" + i + "_" + j;
                    Plotly.newPlot(plot_id, appliance_data, appliance_layout);
                }
                total_plot_id = "plot_" + i + "_total";
                Plotly.newPlot(total_plot_id, total_data, total_layout);
            }
        }

        $("#displayButton").click( function() {
            selected_filename = $("#outputs").val();
            selected_id = selected_filename.split(".")[0];
            window.location.replace('/results/'+selected_id+"/hourly");
        }) 

         $("#totalLink").attr("href", "/results/" + filename.split(".")[0] + "/total");
        $("#hourlyLink").attr("href", "/results/" + filename.split(".")[0] + "/hourly");
    });

</script>


<div class="container-fluid">

    <h1> Energy Simulation Results </h1>

    <hr> 

    <a href="/"> Back to Setup </a>

    <hr> 

    <h4> Output Files:  </h4>
    <select size="10" id="outputs" style="width:400px;">
    </select> <br />
    <input type="button" value="Display Selected" id="displayButton">

    <br /><br />

    <div id="settings"></div>

    <a id="hourlyLink" href=""> View Hourly Results </a> | 
    <a id="totalLink" href=""> View Total Results </a>

    <hr> 

    <div id="plotsContainer"></div>

</div>



